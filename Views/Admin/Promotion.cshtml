 
@{ 
    Layout = "_LayoutAdmin"; 
} 
 
<!DOCTYPE html> 
 
<html> 
<head> 
    <meta name="viewport" content="width=device-width" /> 
    <title>Promotion</title> 
</head> 
<body> 
    <div class="main-panel"> 
        <div class="content-wrapper"> 
            <div class="col-12 grid-margin"> 
                <div class="card"> 
                    <div class="card-body"> 
                        <h1 class="text-primary text-center">จัดการโปรโมชัน</h1>                                             
                     
                        <br /> 
                        <table id="tblPromotion" class="table table-hover" style="table-layout: fixed;"> 
                            <thead> 
                                <tr> 
                                    <th class="h2 productth text-primary" width="8%">ชื่อ</th> 
                                    <th class="h2 productth text-primary" width="50%">รายละเอียด</th> 
                                    <th class="h2 productth text-primary" width="5">ราคา</th> 
                                    <th class="h2 productth text-primary">วันที่เริ่ม</th> 
                                    <th class="h2 productth text-primary">วันสิ้นสุด</th> 
                                    <th class="h2 productth text-primary text-center">จัดการ</th> 
                                </tr> 
                            </thead> 
                            <tbody></tbody> 
                        </table> 
                      
                        <div class="progress mt-4 mb-4">
                            <div class="progress-bar bg-primary progress-bar-striped progress-bar-animated" role="progressbar"
                                style="width: 100%" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100">
                        </div>
          </div>
                            <div class="row"> 
                                <div class="col-md-6"> 
                                    <div class="form-group row"> 
                                        <label class="col-sm-3 col-form-label">ชื่อโปรโมชัน</label> 
                                        <div class="col-sm-9"> 
                                            <div class="input-group"> 
                                                <input name="name" id="name" required type="text" class="form-control" 
                                                    placeholder="กรุณากรอกข้อมูล" autocomplete="off"> 
                                                <div class="input-group-append bg-info border-primary"> 
                                                    <span class="input-group-text bg-transparent"> 
                                                        <i class="mdi mdi-city mdi-24px text-white"></i> 
                                                    </span> 
                                                </div> 
                                            </div> 
                                        </div> 
                                    </div> 
                                </div> 
                                <div class="col-md-6"> 
                                    <div class="form-group row"> 
                                        <label class="col-sm-3 col-form-label">ราคา</label> 
                                        <div class="col-sm-9"> 
                                            <div class="input-group"> 
                                                <input name="price" id="price" required type="number"  class="form-control" 
                                                    placeholder="กรุณากรอกข้อมูล" autocomplete="off"> 
                                                <div class="input-group-append bg-info border-primary"> 
                                                    <span class="input-group-text bg-transparent"> 
                                                        <i class="mdi mdi-city mdi-24px text-white"></i> 
                                                    </span> 
                                                </div> 
                                            </div> 
                                        </div> 
                                    </div> 
                                </div> 
                 
                            </div> 

                            <div class="row"> 
                                <div class="col-md-6"> 
                                    <div class="form-group row"> 
                                        <label class="col-sm-3 col-form-label">วันที่เริ่ม</label> 
                                        <div class="col-sm-9"> 
                                            <div class="input-group"> 
                                                <input name="startdate"id="startdate" required type="date" class="form-control" 
                                                    placeholder="กรุณากรอกข้อมูล" autocomplete="off"> 
                                                <div class="input-group-append bg-info border-primary"> 
                                                    <span class="input-group-text bg-transparent"> 
                                                        <i class="mdi mdi-city mdi-24px text-white"></i> 
                                                    </span> 
                                                </div> 
                                            </div> 
                                        </div> 
                                    </div> 
                                </div> 
                                <div class="col-md-6"> 
                                    <div class="form-group row"> 
                                        <label class="col-sm-3 col-form-label">วันที่สิ้นสุด</label> 
                                        <div class="col-sm-9"> 
                                            <div class="input-group"> 
                                                <input name="enddate" id="enddate" required type="date" class="form-control" 
                                                    placeholder="กรุณากรอกข้อมูล" autocomplete="off"> 
                                                <div class="input-group-append bg-info border-primary"> 
                                                    <span class="input-group-text bg-transparent"> 
                                                        <i class="mdi mdi-city mdi-24px text-white"></i> 
                                                    </span> 
                                                </div> 
                                            </div> 
                                        </div> 
                                    </div> 
                                </div>                 
                            </div> 

                            
                            <div class="row"> 
                                <div class="col-md-12"> 
                                    <div class="form-group row"> 
                                        <label class="col-sm-2 col-form-label">รายละเอียด</label> 
                                        <div class="col-sm-10"> 
                                            <div class="input-group"> 
                                                <input name="detail" id="detail" required type="text" class="form-control" 
                                                    placeholder="กรุณากรอกข้อมูล" autocomplete="off"> 
                                                <div class="input-group-append bg-info border-primary"> 
                                                    <span class="input-group-text bg-transparent"> 
                                                        <i class="mdi mdi-city mdi-24px text-white"></i> 
                                                    </span> 
                                                </div> 
                                            </div> 
                                        </div> 
                                    </div> 
                                </div> 
                              
                            </div> 
                                <button id="b1" type="button" class="mt-3 btn btn-1 btn-success btn-rounded btn-block btn-fw"> <i class="mdi mdi-approval"></i>เพิ่มโปรโมชั่น </div> 
                </div> 
            </div> 
        </div> 
    </div> 
    <script> 
        $(document).ready(function () {
            LoadPromotion();
        }); 
 
        $("#b1").click(function () { 
            var name = $("#name").val(); 
            var detail = $("#detail").val(); 
            var price = $("#price").val(); 
            var startdate = $("#startdate").val(); 
            var enddate = $("#enddate").val(); 
            if (name != "" && detail != "" && price != "" && startdate < enddate) { 
                AddPromotion(name, detail, price, startdate, enddate); 
            } else if(name == "" || detail == "" || price == "" || startdate =="" || enddate == "") {                 
                swal({
                    position: 'center',
                    type: 'error',
                    title: 'กรุณากรอกข้อมูลให้ครบ',                            
                    showConfirmButton: false,
                    timer: 3000
                });
            } else if (startdate > enddate ){
                 swal({
                    position: 'center',
                    type: 'error',
                    title: 'วันที่เริ่มต้นต้องน้อยกว่าวันที่สิ้นสุด',                            
                    showConfirmButton: false,
                    timer: 3000
                });
            }
        }); 
 
        function AddPromotion(name, detail, price, startdate,enddate) { 
            $.ajax({
                type: "post",
                url: "../Admin/AddPromotion?title=" + name + "&detail=" + detail + "&price=" + price + "&startdate=" + startdate + "&enddate=" + enddate,
                success: function (result) {
                    if (result == "Fail") {
                        swal({
                            position: 'center',
                            type: 'error',
                            title: 'เพิ่มโปรโมชั่นล้มเหลว',
                            showConfirmButton: false,
                            timer: 3000
                        });
                    } else {
                        swal({
                            position: 'center',
                            type: 'success',
                            title: 'เพิ่มโปรโมชั่นสำเร็จ',
                            showConfirmButton: false,
                            timer: 2000
                        });
                        LoadPromotion();
                    }
                }
            });  
        } 
 
        function LoadPromotion() {
            $("#tblPromotion tbody tr").remove();
            $.ajax({
                type: 'post',
                url: '../Admin/LoadPromotion',
                dataType: 'json',
                success: function (promotions) {
                    var items = '';
                    $.each(promotions, function (i, item) {
                        var rows = "<tr>"
                            + "<td>" + item.title + "</td>"
                            + "<td>" + item.detail + "</td>"
                            + "<td>" + item.price + "</td>"
                            + "<td>" + item.startDate + "</td>"
                            + "<td>" + item.endDate + "</td>"
                            + "<td class='text-center'><a class = 'badge badge-danger' href='#' onclick='deletePromotion(" + item.promotion_id + ")'>ลบ</a></td>"
                            + "</tr>";
                        $('#tblPromotion tbody').append(rows);
                    });
                },
                error: function (ex) {
                    var r = jQuery.parseJSON(response.responseText);
                    alert("Message: " + r.Message);
                    alert("StackTrace: " + r.StackTrace);
                    alert("ExceptionType: " + r.ExceptionType);
                }
            });
        } 
 
        function deletePromotion(pid) {
            $.ajax({
                type: "post",
                url: "../Admin/DeletePromotion?promotion_id=" + pid,
                success: function (result) {
                    if (result == "Fail") {
                        swal({
                            position: 'center',
                            type: 'error',
                            title: 'ลบโปรโมชั่นล้มเหลว',
                            showConfirmButton: false,
                            timer: 3000
                        });
                    } else {
                        swal({
                            position: 'center',
                            type: 'success',
                            title: 'ลบโปรโมชั่นเรียบร้อย',
                            showConfirmButton: false,
                            timer: 2000
                        });
                        LoadPromotion();
                    }
                }
            });
        } 
    </script> 
</body> 
</html> 
